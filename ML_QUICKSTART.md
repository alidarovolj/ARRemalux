# üöÄ ML Integration - Quick Start

## ‚úÖ –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ (–º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É)

### 1. Unity Infrastructure (Phase 1 - –ó–ê–í–ï–†–®–ï–ù–ê)

**–§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã:**
- ‚úÖ `Assets/Scripts/ML/MLSegmentationManager.cs` - ML –º–µ–Ω–µ–¥–∂–µ—Ä —Å Flood Fill
- ‚úÖ `Assets/Scripts/AR/WallDetectionAndPainting.cs` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ML (—Ä–µ–∂–∏–º "Fill Whole Wall")
- ‚úÖ `Assets/ML/optimum:segformer-b0-finetuned-ade-512-512/` - –ú–æ–¥–µ–ª—å –∏ –∫–æ–Ω—Ñ–∏–≥
- ‚úÖ `Assets/ML/README_ML_INTEGRATION.md` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ Flood Fill –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤—Å–µ–π —Å—Ç–µ–Ω—ã
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∞—Å—Å–∞ –ø–∏–∫—Å–µ–ª—è (IsWall, IsDoor, GetPixelClass)
- ‚úÖ –î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è:
  - –¢–æ—á–µ—á–Ω–æ–µ (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π)
  - "–í—Å—è —Å—Ç–µ–Ω–∞" (–∫–∞–∫ Dulux - –Ω–æ–≤—ã–π!)

---

## üöß –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ–π —Ä–∞–±–æ—Ç—ã (Phase 2)

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞, –Ω—É–∂–Ω—ã native –ø–ª–∞–≥–∏–Ω—ã**

ML –º–æ–¥–µ–ª—å (`model.onnx`) –µ—Å—Ç—å, –Ω–æ Unity **–Ω–µ –º–æ–∂–µ—Ç –Ω–∞–ø—Ä—è–º—É—é** –∑–∞–ø—É—Å–∫–∞—Ç—å ONNX inference. –ù—É–∂–Ω—ã:

1. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–æ–¥–µ–ª–∏:**
   - ONNX ‚Üí CoreML (–¥–ª—è iOS) - ~70 MB
   - ONNX ‚Üí TFLite (–¥–ª—è Android) - ~70 MB

2. **Native –ø–ª–∞–≥–∏–Ω—ã:**
   - iOS: Objective-C++ –ø–ª–∞–≥–∏–Ω –¥–ª—è CoreML
   - Android: Kotlin –ø–ª–∞–≥–∏–Ω –¥–ª—è TFLite

3. **P/Invoke –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
   - Unity C# ‚Üî Native –∫–æ–¥

---

## üìã Roadmap (2-3 –Ω–µ–¥–µ–ª–∏)

### –ù–µ–¥–µ–ª—è 1: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ + iOS –ø–ª–∞–≥–∏–Ω
- [ ] **–î–µ–Ω—å 1-2:** –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ONNX ‚Üí CoreML
- [ ] **–î–µ–Ω—å 3-5:** –°–æ–∑–¥–∞—Ç—å iOS –ø–ª–∞–≥–∏–Ω (CoreMLSegmentation.mm)
- [ ] **–î–µ–Ω—å 6-7:** P/Invoke –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è + —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ iPhone

### –ù–µ–¥–µ–ª—è 2: Android –ø–ª–∞–≥–∏–Ω
- [ ] **–î–µ–Ω—å 1-2:** –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ONNX ‚Üí TFLite
- [ ] **–î–µ–Ω—å 3-5:** –°–æ–∑–¥–∞—Ç—å Android –ø–ª–∞–≥–∏–Ω (TFLiteSegmentation.kt)
- [ ] **–î–µ–Ω—å 6-7:** JNI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è + —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ù–µ–¥–µ–ª—è 3: –ü–æ–ª–∏—Ä–æ–≤–∫–∞
- [ ] **–î–µ–Ω—å 1-3:** –ü–æ–ª–Ω–∞—è –∑–∞–ª–∏–≤–∫–∞ —Å—Ç–µ–Ω—ã (–Ω–µ —Ç–æ—á–∫–∞, –∞ –≤—Å—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å)
- [ ] **–î–µ–Ω—å 4-5:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (throttling, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [ ] **–î–µ–Ω—å 6-7:** UI + UX (preview, undo/redo)

---

## üéØ –î–≤–∞ –ø—É—Ç–∏ –≤–ø–µ—Ä—ë–¥

### –ü—É—Ç—å A: –Ø –¥–µ–ª–∞—é (2-3 –Ω–µ–¥–µ–ª–∏)
–Ø –º–æ–≥—É —Å–æ–∑–¥–∞—Ç—å –≤—Å–µ native –ø–ª–∞–≥–∏–Ω—ã, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ –∏ –¥–æ–≤–µ—Å—Ç–∏ –¥–æ –ø–æ–ª–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü–æ–ª–Ω–∞—è Dulux-–ø–æ–¥–æ–±–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ 95% —Ç–æ—á–Ω–æ—Å—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Å—Ç–µ–Ω
- ‚úÖ "–ö–ª–∏–∫ ‚Üí –≤—Å—è —Å—Ç–µ–Ω–∞ –≤—ã–¥–µ–ª—è–µ—Ç—Å—è"

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå 2-3 –Ω–µ–¥–µ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚ùå +50-70 MB —Ä–∞–∑–º–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚ùå –°–Ω–∏–∂–µ–Ω–∏–µ FPS —Å 60 –¥–æ 50

### –ü—É—Ç—å B: Hybrid –ø–æ–¥—Ö–æ–¥ (5 –¥–Ω–µ–π)
–í–º–µ—Å—Ç–æ ML –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ARKit plane merging + region growing.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ 5 –¥–Ω–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ 0 MB –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
- ‚úÖ 60 FPS

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå 80% —Ç–æ—á–Ω–æ—Å—Ç—å (–Ω–µ 95%)
- ‚ùå –ú–æ–∂–µ—Ç –≤–∫–ª—é—á–∏—Ç—å –¥–≤–µ—Ä–∏ –≤ —Å—Ç–µ–Ω—É

---

## üí° –ú–æ—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ù–∞—á–Ω–∏—Ç–µ —Å –ü—É—Ç–∏ B (hybrid)**, –∞ –ø–æ—Ç–æ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ Dulux-—Ç–æ—á–Ω–æ—Å—Ç—å ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –Ω–∞ –ü—É—Ç—å A.

**–ü–æ—á–µ–º—É:**
1. –ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (5 –¥–Ω–µ–π vs 3 –Ω–µ–¥–µ–ª–∏)
2. –ú–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å UX –¥–æ ML investment
3. 80% —Ç–æ—á–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è MVP
4. ML –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞!)

---

## üì± –ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –°–ï–ô–ß–ê–°

### –¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ Flood Fill (–±–µ–∑ real ML inference)

1. –í Unity —Å–æ–∑–¥–∞–π—Ç–µ **—Ç–µ—Å—Ç–æ–≤—É—é –º–∞—Å–∫—É** (512x512):
```csharp
// –í MLSegmentationManager.Start()
// –í–†–ï–ú–ï–ù–ù–´–ô —Ç–µ—Å—Ç –±–µ–∑ real inference
currentSegmentationMask = new byte[512 * 512];

// –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
for (int y = 0; y < 512; y++)
{
    for (int x = 0; x < 512; x++)
    {
        // –õ–µ–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ = —Å—Ç–µ–Ω–∞ (0), –ø—Ä–∞–≤–∞—è = –¥–≤–µ—Ä—å (14)
        int classId = x < 256 ? 0 : 14;
        currentSegmentationMask[y * 512 + x] = (byte)classId;
    }
}
```

2. –í–∫–ª—é—á–∏—Ç–µ —Ä–µ–∂–∏–º—ã:
   - `enableMLSegmentation = true`
   - `fillWholeWallMode = true`

3. –¢–∞–ø–Ω–∏—Ç–µ –Ω–∞ –ª–µ–≤—É—é –ø–æ–ª–æ–≤–∏–Ω—É —ç–∫—Ä–∞–Ω–∞ ‚Üí Flood Fill –¥–æ–ª–∂–µ–Ω –≤—ã–¥–µ–ª–∏—Ç—å –≤—Å—é –ª–µ–≤—É—é –ø–æ–ª–æ–≤–∏–Ω—É!

---

## üîß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å:

**A) –ü—É—Ç—å A (ML, –∫–∞–∫ Dulux)** - –Ω–∞—á–∏–Ω–∞—é –¥–µ–ª–∞—Ç—å native –ø–ª–∞–≥–∏–Ω—ã? (2-3 –Ω–µ–¥–µ–ª–∏)

**B) –ü—É—Ç—å B (Hybrid ARKit)** - –¥–µ–ª–∞—é plane merging –≤–º–µ—Å—Ç–æ ML? (5 –¥–Ω–µ–π)

**C) –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** - –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Å —Ç–µ–∫—É—â–∏–º –∫–æ–¥–æ–º (`minWallArea = 0.3`) –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–∞–∑–æ–≤–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ?

–ß—Ç–æ –≤—ã–±–∏—Ä–∞–µ—Ç–µ? üöÄ

---

**–°–æ–∑–¥–∞–Ω–æ:** 30 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** Phase 1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –≥–æ—Ç–æ–≤–æ –∫ Phase 2


