# üé® –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è ML Segmentation - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê!

**DeepLabV3 –ù–ï –ü–û–î–•–û–î–ò–¢ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–µ–Ω!**

–ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ –Ω–∞ PASCAL VOC 2012 (—É–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω—ã):
```
–ö–ª–∞—Å—Å—ã: aeroplane, bicycle, bird, boat, bottle, bus, car, cat, chair, 
cow, diningTable, dog, horse, motorbike, person, pottedPlant, sheep, 
sofa, train, tvOrMonitor
```

**‚ùå –ö–ª–∞—Å—Å "wall" –û–¢–°–£–¢–°–¢–í–£–ï–¢!**

---

## üéØ –ß—Ç–æ –î–µ–ª–∞—Ç—å –°–ï–ô–ß–ê–°

### **1. –î–æ–±–∞–≤–∏—Ç—å –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é (—á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —á—Ç–æ –º–æ–¥–µ–ª—å –≤–∏–¥–∏—Ç)**

#### –í Unity Editor:

1. **–°–æ–∑–¥–∞–π—Ç–µ UI Canvas:**
   - `GameObject ‚Üí UI ‚Üí Canvas`
   - Canvas Scaler ‚Üí UI Scale Mode: **Scale With Screen Size**
   - Reference Resolution: **1920 x 1080**

2. **–°–æ–∑–¥–∞–π—Ç–µ RawImage –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:**
   - –ü—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –Ω–∞ Canvas ‚Üí `UI ‚Üí Raw Image`
   - –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ: `MLSegmentationOverlay`
   - RectTransform:
     - Anchor Presets: **Stretch** (Alt+Click –Ω–∞ –ø—Ä–∞–≤—ã–π –Ω–∏–∂–Ω–∏–π –∫–≤–∞–¥—Ä–∞—Ç)
     - Left: 0, Top: 0, Right: 0, Bottom: 0
   - Color: –ë–µ–ª—ã–π (R:255, G:255, B:255, **A:128** –¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏)

3. **–î–æ–±–∞–≤—å—Ç–µ MLSegmentationDebugViewer:**
   - –ù–∞ –æ–±—ä–µ–∫—Ç `MLSegmentationOverlay` –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:
     - **Add Component ‚Üí MLSegmentationDebugViewer**
   - –í –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–µ:
     - ML Manager: –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –≤–∞—à `MLSegmentationManager` GameObject
     - Overlay Alpha: **0.5** (50% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å)
     - Show Only Walls: **false** (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å—ë –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)

4. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Ü–µ–Ω—É –∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ!**

---

### **2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏ –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ß—Ç–æ –ú–æ–¥–µ–ª—å –í–∏–¥–∏—Ç**

–ü–æ—Å–ª–µ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏:
1. –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ **–ª—é–¥–µ–π, –º–µ–±–µ–ª—å, —Ç–µ—Ö–Ω–∏–∫—É**
2. –í—ã —É–≤–∏–¥–∏—Ç–µ **—Ü–≤–µ—Ç–Ω–æ–π overlay** –Ω–∞ —ç—Ç–∏—Ö –æ–±—ä–µ–∫—Ç–∞—Ö
3. **–°—Ç–µ–Ω—ã –±—É–¥—É—Ç –Ω–µ–≤–∏–¥–∏–º—ã** (—Ç–∞–∫ –∫–∞–∫ DeepLabV3 –∏—Ö –Ω–µ –∑–Ω–∞–µ—Ç!)

---

## üîç –û—Ç–ª–∞–¥–∫–∞

### **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–ª–∞—Å—Å–æ–≤:**

–í Unity Editor, –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ:
1. –í—ã–±–µ—Ä–∏—Ç–µ `MLSegmentationOverlay` –≤ Hierarchy
2. –í Inspector –Ω–∞–π–¥–∏—Ç–µ `MLSegmentationDebugViewer`
3. –ù–∞–∂–º–∏—Ç–µ –ø—Ä–∞–≤—É—é –∫–Ω–æ–ø–∫—É –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞ ‚Üí **Show Class Statistics**
4. –í Console —É–≤–∏–¥–∏—Ç–µ —á—Ç–æ –º–æ–¥–µ–ª—å –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç (person, chair, sofa –∏ —Ç.–¥.)

---

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ú–æ–¥–µ–ª—å: SegFormer-B0 ADE20K

**–ù—É–∂–Ω–∞ –º–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–Ω–∞—è –Ω–∞ ADE20K Indoor Scenes!**

### –ö–ª–∞—Å—Å—ã ADE20K (–µ—Å—Ç—å wall!):
```
0: wall ‚úÖ
1: building
2: sky
3: floor ‚úÖ
4: tree
5: ceiling ‚úÖ
12: person ‚úÖ
14: door ‚úÖ
19: chair
23: sofa
```

### –ì–¥–µ –í–∑—è—Ç—å CoreML –ú–æ–¥–µ–ª—å?

**–ü—Ä–æ–±–ª–µ–º–∞:** –ì–æ—Ç–æ–≤–æ–π CoreML –º–æ–¥–µ–ª–∏ SegFormer-B0 ADE20K –Ω–µ—Ç –Ω–∞ HuggingFace.

**–†–µ—à–µ–Ω–∏—è:**

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ (—Å–ª–æ–∂–Ω–æ)

1. –°–∫–∞—á–∞—Ç—å PyTorch –º–æ–¥–µ–ª—å: `huggingface.co/nvidia/segformer-b0-finetuned-ade-512-512`
2. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ ONNX
3. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ONNX ‚Üí CoreML (—á–µ—Ä–µ–∑ `coremltools`)
4. **–ü—Ä–æ–±–ª–µ–º–∞:** Python dependency hell (—É–∂–µ –ø—Ä–æ–±–æ–≤–∞–ª–∏!)

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ì–æ—Ç–æ–≤—É—é CoreML –ú–æ–¥–µ–ª—å –î—Ä—É–≥–æ–π –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** DeepLabV3 ResNet50 **trained on ADE20K** (–Ω–µ PASCAL VOC!)

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–π—Ç–∏ –Ω–∞:
- Apple's ML Models Gallery: `developer.apple.com/machine-learning/models`
- CoreML Models Zoo: `github.com/john-rocky/CoreML-Models`

#### –í–∞—Ä–∏–∞–Ω—Ç C: –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ü–æ–¥—Ö–æ–¥ (–±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é** + Depth API (–±–µ–∑ ML):
1. Depth API ‚Üí –∫–∞—Ä—Ç–∞ –≥–ª—É–±–∏–Ω—ã
2. Plane detection ‚Üí —Å—Ç–µ–Ω—ã
3. –§–∏–ª—å—Ç—Ä—ã –ø–æ –≤—ã—Å–æ—Ç–µ/—Ä–∞–∑–º–µ—Ä—É/aspect ratio
4. **–ü—Ä–æ—â–µ –∏ –±—ã—Å—Ç—Ä–µ–µ**, –Ω–æ –º–µ–Ω–µ–µ —Ç–æ—á–Ω–æ

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

### **–î–ª—è –î–µ–º–æ (–°–µ–π—á–∞—Å):**

1. ‚úÖ –î–æ–±–∞–≤—å—Ç–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é (—Å–º. –≤—ã—à–µ)
2. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ DeepLabV3 –≤–∏–¥–∏—Ç –ª—é–¥–µ–π/–º–µ–±–µ–ª—å
3. ‚ö†Ô∏è **–í—Ä–µ–º–µ–Ω–Ω–æ:** –ú–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å —á—Ç–æ "background" (–∫–ª–∞—Å—Å 0) = —Å—Ç–µ–Ω–∞
   - –≠—Ç–æ **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ** –Ω–æ –¥–∞—Å—Ç –∫–∞–∫–æ–π-—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Ç–µ—Å—Ç–∞

### **–î–ª—è Production:**

1. ‚ùå –ó–∞–º–µ–Ω–∏—Ç—å DeepLabV3 PASCAL VOC
2. ‚úÖ –ù–∞–π—Ç–∏/–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å —Å ADE20K –∫–ª–∞—Å—Å–∞–º–∏
3. ‚úÖ –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Depth API + –≥–µ–æ–º–µ—Ç—Ä–∏—é

---

## üé® –¶–≤–µ—Ç–∞ –ö–ª–∞—Å—Å–æ–≤ (DeepLabV3 PASCAL VOC)

–ï—Å–ª–∏ —É–≤–∏–¥–∏—Ç–µ —ç—Ç–∏ —Ü–≤–µ—Ç–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ:

| –¶–≤–µ—Ç | –ö–ª–∞—Å—Å |
|------|-------|
| –ö—Ä–∞—Å–Ω—ã–π | person ‚ù§Ô∏è |
| –ó–µ–ª–µ–Ω—ã–π | chair ü™ë |
| –°–∏–Ω–∏–π | sofa üõãÔ∏è |
| –ñ–µ–ª—Ç—ã–π | car üöó |
| –ü—É—Ä–ø—É—Ä–Ω—ã–π | bottle üçæ |

**–°—Ç–µ–Ω—ã = –Ω–µ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã!** (–∫–ª–∞—Å—Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)

---

## üÜò –ï—Å–ª–∏ –í–æ–æ–±—â–µ –ù–∏—á–µ–≥–æ –ù–µ –í–∏–¥–Ω–æ

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `MLSegmentationManager.enableMLSegmentation = true`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Canvas ‚Üí Render Mode = **Screen Space - Overlay**
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ RawImage –Ω–∞—Ö–æ–¥–∏—Ç—Å—è **–ø–æ–≤–µ—Ä—Ö AR Camera**
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `[CoreMLSegmentation] ‚ö° Inference time: XXms`

---

## üí° –í—Ä–µ–º–µ–Ω–Ω—ã–π Workaround

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ **–±—ã—Å—Ç—Ä–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å**:

–í `MLSegmentationManager.cs` –∏–∑–º–µ–Ω–∏—Ç–µ:
```csharp
private const int WALL_CLASS = 0; // background ‚Üí –≤—Ä–µ–º–µ–Ω–Ω–æ —Å—á–∏—Ç–∞–µ–º —Å—Ç–µ–Ω–æ–π!
```

–≠—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –ø–æ–∫–∞–∂–µ—Ç **—á—Ç–æ-—Ç–æ** –Ω–∞ —ç–∫—Ä–∞–Ω–µ –¥–ª—è —Ç–µ—Å—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

